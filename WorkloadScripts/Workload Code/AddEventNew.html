<!DOCTYPE html>
<html lang="en">
    <head>
    <base target="_top">
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <style>
        .form-control::placeholder {
            color: darkblue;
            opacity: 0.4;
            }
        .my::placeholder { 
            color: red;
            }
        .vf::placeholder { 
            color: red;
            }
        .event::placeholder { 
            color: red;
            }
        .mrd::placeholder {
            color: red;
            }
        .pm::placeholder {
            color: red;
            }
        .eventtype::placeholder {
            color: red;
            }
        </style>

        <title>Add New Event</title>
    </head>
    <body>
    <form method="post" name="newEvent" class="needs-validation" novalidate>
        <div class="container">
            <div class="row">
                <div class="form-group col">
                <!--Model Year (Text)-->
                    <label class="h6" for="model-year">Model Year*</label>
                    <input type="text" class="form-control my" id="model-year" placeholder="ex: 2022" required>
                </div>

                <!--Vehicle Family (Text)-->
                <div class="form-group col">
                    <label class="h6" for="vehicle-family">Vehicle Family*</label>
                    <input type="text" class="form-control vf" id="vehicle-family" placeholder="ex: WL" required>
                </div>
            </div>

            <!--Event Name (Text)-->
            <div class="form-group">
                <label class="h6" for="event-name">Event Name*</label>
                <input type="text" class="form-control event" id="event-name" placeholder="ex: Sled Series" required="true">
            </div>

            <div class="row">
                <!--Earliest MRD (Text) **CHANGE TO DATE**-->
                <div class="form-group col">
                    <label class="h6" for="orig-MRD">Earliest MRD*</label>
                    <input class="form-control mrd" name="date" placeholder="MM/DD/YYYY" type="text" id="orig-MRD" required="true">
                </div>

                <!--Event Type (Text)-->
                <div class="form-group col">
                    <label class="h6" for="event-type">Event Type*</label>
                    <input type="text" class="form-control eventtype" placeholder= "ex: QAF" id="event-type" required="true">
                </div>
            </div>

            <!--Program Manager (Text)-->
            <div class="form-group">
                <label class="h6" for="program-manager">Program Manager*</label>
                <input type="text" class="form-control pm" placeholder= "ex: Mark Ballo" id="program-manager" required="true">
            </div>

            <!--Comments (Text)-->
            <div class="form-group">
                <label class="h6" for="commentsH">Comments</label>
                <input type="text" class="form-control" placeholder="ex: Additonal info" id="commentsH">
            </div>
            
            <div class="row">
                <!--WBS Code (Text)-->
                <div class="form-group col">
                    <label class="h6" for="wbs">WBS Code</label>
                    <input type="text" class="form-control" placeholder="ex: VD00194" id="wbs">
                </div> 
                
                <!--Initial Part Number (Text)-->
                <div class="form-group col">
                    <label class="h6" for="init-parts">No. of Parts</label>
                    <input type="text" class="form-control" placeholder="ex: 100" id="init-parts">
                </div>
            </div>

            <!--Requestor (Text)-->
            <div class="form-group">
                <label class="h6" for="requestor">Requestor(s)</label>
                <input type="text" class="form-control" placeholder="ex: John Doe" id="requestor">
            </div>

             <!--Location-->
             <div class="form-group">
                 <label class="h6" for="location">Location</label>
                 <input type="text" class="form-control" placeholder="ex: CPG" id="location">
             </div>

            <!--Attention-->
            <div class="form-group">
                <label class="h6" for="attn">Attention-to</label>
                <input type="text" class="form-control" placeholder="ex: Jane Doe" id="attn">
            </div>

            <!--Ship-to Code (Text)-->
            <div class="form-group">
                <label class="h6" for="shipcode">Ship-to Code</label>
                <input type="text" class="form-control" placeholder= "ex: 1250" id="shipcode">
            </div>

            <!--Ship-to Address-->
            <div class="form-group">
                <label class="h6" for="shipadd">Ship-to Address</label>
                <input type="text" class="form-control" placeholder= "ex: 12501 Chrysler Dr" id="shipadd">
            </div>

            <div class="d-grid gap-2">
              <button class="btn btn-outline-warning btn-primary" id="mainButton" disabled>Add New Event</button>
            </div>
        </div>
        </form>
        <!-- Optional Bootstrap JavaScript Bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>        

        <script> 
            // Validate required entries before allowing the form to be submitted
            var frm = document.querySelector('form');
            
            frm.onchange = function() {
                var modelYear = document.getElementById("model-year").value;
                var vehicleFamily = document.getElementById("vehicle-family").value;
                var eventName = document.getElementById("event-name").value;
                var origMRD = document.getElementById("orig-MRD").value;
                var programManager = document.getElementById("program-manager").value;
                var eventType = document.getElementById("event-type").value;
                var btn = document.querySelector('button');
                if (modelYear !== "" && vehicleFamily !== "" && eventName !== "" && origMRD !== "" && programManager !== "" && eventType !== "") {
                    btn.disabled = false;
                    btn.classList.remove('btn-outline-warning');
                    btn.classList.add('btn-primary');
                } else {
                    btn.disabled = true;
                }
            }

            //Triggered by 'click' listener
            function afterButtonClicked(){

                //Store input values as variables
                var modelYear = document.getElementById("model-year");
                var vehicleFamily = document.getElementById("vehicle-family");
                var eventName = document.getElementById("event-name");
                var eventType = document.getElementById("event-type");
                var eventTitle = modelYear.value + " " + vehicleFamily.value.toUpperCase() + " " + eventName.value;
                var origMRD = document.getElementById("orig-MRD");
                var eventStatus = "In-Process";        
                var programManager = document.getElementById("program-manager");
                var comments = document.getElementById("commentsH");
                var initPNs = document.getElementById("init-parts");
                var requestor = document.getElementById("requestor");
                var wbs = document.getElementById("wbs");
                var location = document.getElementById("location");
                var attn = document.getElementById("attn");
                var shipcode = document.getElementById("shipcode");
                var shipadd = document.getElementById("shipadd");

                //Assemble variables into row data       
                var rowData = {
                                modelYear: modelYear.value,
                                vehicleFamily: vehicleFamily.value.toUpperCase(),
                                eventName: eventName.value,
                                eventType:eventType.value,
                                eventTitle,
                                origMRD: origMRD.value,
                                eventStatus,
                                programManager: programManager.value,
                                comments: comments.value,
                                initPNs: initPNs.value, 
                                requestor: requestor.value,
                                wbs: wbs.value,
                                location: location.value,
                                attn: attn.value,
                                shipcode: shipcode.value,
                                shipadd: shipadd.value
                                };

            //Runs addNewRow script first, then afterSubmit script when complete
                google.script.run.withSuccessHandler(afterSubmit).addNewRow(rowData);
                              
                //Create new tracker and format the row
                //google.script.run.withSuccessHandler(afterSubmit).formatRowCreateTracker();
                
                // Close the form
                //google.script.host.close();
                //google.script.host.close();

                            
            }

            //Clear form after row added & format new row
            function afterSubmit(e){     

                //Clear form input fields
                var modelYear = document.getElementById("model-year");
                var vehicleFamily = document.getElementById("vehicle-family");
                var eventName = document.getElementById("event-name");
                var eventType = document.getElementById("event-type");
                var origMRD = document.getElementById("orig-MRD");         
                var programManager = document.getElementById("program-manager");
                var comments = document.getElementById("commentsH");
                var initPNs = document.getElementById("init-parts");   
                var requestor = document.getElementById("requestor");  
                var wbs = document.getElementById("wbs");  
                var location = document.getElementById("location");  
                var attn = document.getElementById("attn");  
                var shipcode = document.getElementById("shipcode"); 
                var shipadd = document.getElementById("shipadd");  
                modelYear.value="";
                vehicleFamily.value="";
                eventName.value="";
                eventType.value="";
                origMRD.value="";
                programManager.value="";   
                comments.value="";
                initPNs.value="";
                requestor.value="";
                wbs.value="";
                location.value="";
                attn.value="";
                shipcode.value="";
                shipadd.value="";
            }

            /*
            function afterSidebarLoads(){
                google.script.run.withSuccessHandler(afterPMDDAReturned).getProgMgrDDA();
                google.script.run.withSuccessHandler(afterETDDAReturned).getEventTypeDDA();
            }


            function afterPMDDAReturned(arrayOfArrays) {
                var item = document.getElementById("program-manager");      
                arrayOfArrays.forEach(function(r){
                var option = document.createElement("option");
                option.textContent = r[0];
                item.appendChild(option);        
            });     
            }

            function afterETDDAReturned(arrayOfArrays) {
                var item = document.getElementById("event-type");      
                arrayOfArrays.forEach(function(r){
                var option = document.createElement("option");
                option.textContent = r[0];
                item.appendChild(option);        
                });     
            }
            */
            
            document.getElementById("mainButton").addEventListener("click",afterButtonClicked);
            //document.addEventListener("DOMContentLoaded",afterSidebarLoads);
        </script>
    </body>
</html>
